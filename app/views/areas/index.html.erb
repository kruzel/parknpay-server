<script>
    function showRates(area_id, city_id) {
        $('#area-rates').attr('data-source','/cities/'+city_id+'/areas/'+area_id+'/rates.json');

        $('#area-rates').dataTable( {
            "sDom": "<'row'<'span6'l><'span6'f>r>t<'row'<'span6'i><'span6'p>>",
            "sPaginationType": "bootstrap",
            "bJQueryUI": true,
            "bProcessing": true,
            "bServerSide": true,
            "bDestroy":true,
            "sAjaxSource": $('#area-rates').data('source'),
            "fnServerParams": function ( aoData ) {
                aoData.push( { "area_id": area_id } );
            },
            "oLanguage": {
                "sLengthMenu": "_MENU_ records per page"
            }
        } );

        $("body").append("<a href=/cities/"+city_id+"/areas/"+area_id+"/rates/new >new Rate</>")
    }
</script>
<meta name="viewport" content="initial-scale=1.0, user-scalable=no">
<meta charset="utf-8">
<style>
    #map-canvas {
        height: 350px;
        margin: 0px;
        padding: 0px
    }
</style>
<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.3.2/jquery.min.js"></script>
<script type="text/javascript" src="https://maps.googleapis.com/maps/api/js?v=3.exp&sensor=false"></script>
<script type="text/javascript">
    var map;
    function initialize() {
        var mapOptions = {
            zoom: 8,
            center: new google.maps.LatLng(-34.397, 150.644),
            mapTypeId: google.maps.MapTypeId.ROADMAP
        };
        map = new google.maps.Map(document.getElementById('map-canvas'),
                mapOptions);
    }

    google.maps.event.addDomListener(window, 'load', initialize);
</script>

<div class="row-fluid">
<div class="accordion" id="accordionPagination">
<div class="accordion-group">
<div class="accordion-heading">
<a style="text-align: left;text-decoration: none" class="accordion-toggle btn btn-danger"
data-toggle="collapse" data-parent="#accordion2" href="#collapsePagination">
<i class="icon-list"></i> <%= @city.name %> areas <i class="icon-minus pull-right"></i>
</a>
</div>
<div id="collapsePagination" class="accordion-body collapse in">
<div class="accordion-inner" style="background-color: #ffffff;">
<div class="container">
<table cellpadding="0" cellspacing="0" border="0" class="table table-striped table-bordered" id="example">
<thead>
  <tr>
    <th>Area</th>
    <th></th>
    <th></th>
    <th></th>
  </tr>
</thead>
<tbody>
<% @areas.each do |area| %>
  <tr>
    <td><%= area.name %></td>
    <td><%= link_to_function 'Show', "javascript:showRates("+area.id.to_s+","+area.city_id.to_s+")" %></td>
    <td><%= link_to 'Edit', edit_city_area_path(area.city,area) %></td>
    <td><%= link_to 'Destroy', [area.city,area], method: :delete, data: { confirm: 'Are you sure?' } %></td>
  </tr>
<% end %>
</tbody>
</table>
</div>
</div>
</div>
</div>

</div>
</div>

<%= link_to 'New Area', new_city_area_path %>
<br />
<br />

<div class="row-fluid">
    <div class="accordion" id="accordionChart1">
      <div class="accordion-group">
        <div class="accordion-heading">
          <a style="text-align: left;text-decoration: none" class="accordion-toggle btn btn-primary"
             data-toggle="collapse" data-parent="#accordion2" href="#collapseChart1">
            <i class="icon-bar-chart"></i> Areas map <i class="icon-minus pull-right"></i>
          </a>
        </div>
        <div id="collapseChart1" class="accordion-body collapse in">
          <div class="accordion-inner">
            <div id="spline">
              <div id="map-canvas"></div>
            </div>
          </div>
        </div>
      </div>

    </div>
</div>

<br />

<div class="row-fluid">
  <div class="accordion" id="accordionPagination">
    <div class="accordion-group">
      <div class="accordion-heading">
        <a style="text-align: left;text-decoration: none" class="accordion-toggle btn btn-danger"
           data-toggle="collapse" data-parent="#accordion2" href="#collapsePagination">
          <i class="icon-list"></i> Rates for area <%= @city.name + " " + @area.name if @area %> <i class="icon-minus pull-right"></i>
        </a>
      </div>
      <div id="collapsePagination" class="accordion-body collapse in">
        <div class="accordion-inner" style="background-color: #ffffff;">
          <div class="container">
            <table cellpadding="0" cellspacing="0" border="0" class="table table-striped table-bordered" id="area-rates" data-source="">
              <thead>
              <tr>
                <th>Rate</th>
                <th>Currency</th>
                <th>Start Day A Week</th>
                <th>End  Day A Week</th>
                <th>Start time</th>
                <th>End time</th>
                <th>Valid starting</th>
                <th>Valid till</th>
                <th></th>
                <th></th>
                <th></th>
              </tr>
              </thead>
              <tbody>

              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>

  </div>
</div>

<br />

